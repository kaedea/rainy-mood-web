// i18n ÂõΩÈôÖÂåñÈÖçÁΩÆ
const i18n = {
  'zh-CN': {
    'rain': 'Èõ®Â£∞',
    'forest': 'Ê£ÆÊûó',
    'ocean': 'Êµ∑Ê¥ã',
    'city': 'ÂüéÂ∏Ç',
    'language': 'ÂàáÊç¢ËØ≠Ë®Ä',
    'share': 'ÂàÜ‰∫´Ê≠§È°µÈù¢',
    'donate': 'ËØ∑Êàë‰∏ÄÊùØÂíñÂï°',
    'copyLink': 'üîó Â§çÂà∂ÈìæÊé•',
    'favorite': '‚≠ê Êî∂Ëóè',
    'mobileShare': 'üì± ÂàÜ‰∫´',
    'paypal': 'üí≥ PayPal',
    'wechat': 'üí¨ ÂæÆ‰ø°',
    'alipay': 'üí∞ ÊîØ‰ªòÂÆù',
    'qrTitle': 'Êâ´Á†ÅÊîØÊåÅ',
    'qrTip': 'ËØ∑‰ΩøÁî®Áõ∏Â∫îÁöÑ App Êâ´Êèè‰∫åÁª¥Á†Å',
    // SEOÁõ∏ÂÖ≥ÁøªËØë
    'seoTitle': 'Rainee Èõ®Â£∞Êí≠ÊîæÂô® - ÂÖçË¥πÂú®Á∫øÈõ®Â£∞Ê®°Êãü | Âä©Áú†ÊîæÊùæÂÜ•ÊÉ≥‰∏ìÊ≥®',
    'seoDescription': 'RaineeÈõ®Â£∞Êí≠ÊîæÂô®Êèê‰æõÂÖçË¥πÂú®Á∫øÈõ®Â£∞Ê®°Êãü„ÄÅÁôΩÂô™Èü≥Êí≠ÊîæÊúçÂä°„ÄÇÂ∏ÆÂä©Áù°Áú†„ÄÅÊîæÊùæ„ÄÅÂÜ•ÊÉ≥„ÄÅÈõÜ‰∏≠Á≤æÁ•û„ÄÇÊó†ÈúÄ‰∏ãËΩΩÔºåÂç≥ÂºÄÂç≥Áî®ÔºåÊîØÊåÅÂ§öËØ≠Ë®ÄÁïåÈù¢ÔºåËÆ©ÊÇ®ÈöèÊó∂ÈöèÂú∞‰∫´ÂèóÂÆÅÈùôÁöÑÈõ®Â§©Ê∞õÂõ¥„ÄÇ',
    'seoKeywords': 'Èõ®Â£∞Ê®°Êãü,ÁôΩÂô™Èü≥,Âä©Áú†,ÊîæÊùæ,ÂÜ•ÊÉ≥,ÈõÜ‰∏≠Á≤æÁ•û,Ëá™ÁÑ∂Â£∞Èü≥,Âú®Á∫øÊí≠Êîæ,ÂÖçË¥π,rain sounds,white noise,sleep sounds,focus',
    'seoOgTitle': 'Rainee Èõ®Â£∞Êí≠ÊîæÂô® - ÂÖçË¥πÂú®Á∫øÈõ®Â£∞Ê®°Êãü',
    'seoOgDescription': 'RaineeÊèê‰æõÂÖçË¥πÂú®Á∫øÈõ®Â£∞Ê®°Êãü„ÄÅÁôΩÂô™Èü≥Êí≠Êîæ„ÄÇÂ∏ÆÂä©Áù°Áú†„ÄÅÊîæÊùæ„ÄÅÂÜ•ÊÉ≥„ÄÅÈõÜ‰∏≠Á≤æÁ•û„ÄÇÊó†ÈúÄ‰∏ãËΩΩÔºåÂç≥ÂºÄÂç≥Áî®ÔºåÊîØÊåÅÂ§öËØ≠Ë®ÄÁïåÈù¢„ÄÇ',
    'seoTwitterTitle': 'Rainee Èõ®Â£∞Êí≠ÊîæÂô® - ÂÖçË¥πÂú®Á∫øÈõ®Â£∞Ê®°Êãü',
    'seoTwitterDescription': 'RaineeÊèê‰æõÂÖçË¥πÂú®Á∫øÈõ®Â£∞Ê®°Êãü„ÄÅÁôΩÂô™Èü≥Êí≠Êîæ„ÄÇÂ∏ÆÂä©Áù°Áú†„ÄÅÊîæÊùæ„ÄÅÂÜ•ÊÉ≥„ÄÅÈõÜ‰∏≠Á≤æÁ•û„ÄÇ'
  },
  'en-US': {
    'rain': 'Rainy',
    'forest': 'Forest',
    'ocean': 'Ocean',
    'city': 'City',
    'language': 'Switch Language',
    'share': 'Share this page',
    'donate': 'Buy me a coffee',
    'copyLink': 'üîó Copy Link',
    'favorite': '‚≠ê Favorite',
    'mobileShare': 'üì± Share',
    'paypal': 'üí≥ PayPal',
    'wechat': 'üí¨ WeChat',
    'alipay': 'üí∞ Alipay',
    'qrTitle': 'Scan to Donate',
    'qrTip': 'Please use the corresponding app to scan the QR code to complete the payment',
    'seoTitle': 'Rainee Rain Sounds Player - Free Online Rain Simulation for Sleep & Focus',
    'seoDescription': 'Rainee offers free online rain simulation and white noise playback. Helps with sleep, relaxation, meditation, and concentration. No download needed, instant use with multi-language support.',
    'seoKeywords': 'rain simulation,white noise,sleep aid,relaxation,meditation,focus,nature sounds,online playback,free,rain sounds,white noise,sleep sounds,concentration',
    'seoOgTitle': 'Rainee Rain Sounds Player - Free Online Rain Simulation',
    'seoOgDescription': 'Rainee provides free online rain simulation and white noise playback. Helps with sleep, relaxation, meditation, and concentration. No download needed, instant use with multi-language support.',
    'seoTwitterTitle': 'Rainee Rain Sounds Player - Free Online Rain Simulation',
    'seoTwitterDescription': 'Rainee provides free online rain simulation and white noise playback. Helps with sleep, relaxation, meditation, and concentration.'
  },
  'ja-JP': {
    'rain': '„ÅÇ„ÇÅ',
    'forest': '„ÇÇ„Çä',
    'ocean': '„ÅÜ„Åø',
    'city': '„Åæ„Å°',
    'language': 'Ë®ÄË™û„ÇíÂàá„ÇäÊõø„Åà„Çã',
    'share': '„Åì„ÅÆ„Éö„Éº„Ç∏„ÇíÂÖ±Êúâ',
    'donate': 'ÂøúÊè¥„Åô„Çã',
    'copyLink': 'üîó „Ç≥„Éî„Éº',
    'favorite': '‚≠ê „ÅäÊ∞ó„Å´ÂÖ•„Çä',
    'mobileShare': 'üì± ÂÖ±Êúâ',
    'paypal': 'üí≥ PayPal',
    'wechat': 'üí¨ WeChat',
    'alipay': 'üí∞ Alipay',
    'qrTitle': '„Çπ„Ç≠„É£„É≥„Åó„Å¶ÂøúÊè¥',
    'qrTip': 'ÂØæÂøú„Åô„Çã„Ç¢„Éó„É™„ÅßQR„Ç≥„Éº„Éâ„Çí„Çπ„Ç≠„É£„É≥„Åó„Å¶„ÄÅÊîØÊâï„ÅÑ„ÇíÂÆå‰∫Ü„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
    'seoTitle': 'Rainee Èõ®Èü≥„Éó„É¨„Ç§„É§„Éº - ÁÑ°Êñô„Ç™„É≥„É©„Ç§„É≥Èõ®Èü≥„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ | Áù°Áú†„É™„É©„ÇØ„Çº„Éº„Ç∑„Éß„É≥ÁûëÊÉ≥ÈõÜ‰∏≠',
    'seoDescription': 'Rainee„ÅØÁÑ°Êñô„ÅÆ„Ç™„É≥„É©„Ç§„É≥Èõ®Èü≥„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Å®„Éõ„ÉØ„Ç§„Éà„Éé„Ç§„Ç∫ÂÜçÁîü„ÇíÊèê‰æõ„Åó„Åæ„Åô„ÄÇÁù°Áú†„ÄÅ„É™„É©„ÇØ„Çº„Éº„Ç∑„Éß„É≥„ÄÅÁûëÊÉ≥„ÄÅÈõÜ‰∏≠ÂäõÂêë‰∏ä„Å´ÂΩπÁ´ã„Å°„Åæ„Åô„ÄÇ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ‰∏çË¶Å„Åß„ÄÅÂç≥Â∫ß„Å´‰ΩøÁî®ÂèØËÉΩ„ÄÅÂ§öË®ÄË™û„Çµ„Éù„Éº„Éà‰ªò„Åç„ÄÇ',
    'seoKeywords': 'Èõ®Èü≥„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥,„Éõ„ÉØ„Ç§„Éà„Éé„Ç§„Ç∫,Áù°Áú†ÊîπÂñÑ,„É™„É©„ÇØ„Çº„Éº„Ç∑„Éß„É≥,ÁûëÊÉ≥,ÈõÜ‰∏≠Âäõ,Ëá™ÁÑ∂Èü≥,„Ç™„É≥„É©„Ç§„É≥ÂÜçÁîü,ÁÑ°Êñô,Èõ®Èü≥,„Éõ„ÉØ„Ç§„Éà„Éé„Ç§„Ç∫,Áù°Áú†Èü≥,ÈõÜ‰∏≠',
    'seoOgTitle': 'Rainee Èõ®Èü≥„Éó„É¨„Ç§„É§„Éº - ÁÑ°Êñô„Ç™„É≥„É©„Ç§„É≥Èõ®Èü≥„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥',
    'seoOgDescription': 'Rainee„ÅØÁÑ°Êñô„ÅÆ„Ç™„É≥„É©„Ç§„É≥Èõ®Èü≥„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Å®„Éõ„ÉØ„Ç§„Éà„Éé„Ç§„Ç∫ÂÜçÁîü„ÇíÊèê‰æõ„Åó„Åæ„Åô„ÄÇÁù°Áú†„ÄÅ„É™„É©„ÇØ„Çº„Éº„Ç∑„Éß„É≥„ÄÅÁûëÊÉ≥„ÄÅÈõÜ‰∏≠ÂäõÂêë‰∏ä„Å´ÂΩπÁ´ã„Å°„Åæ„Åô„ÄÇ',
    'seoTwitterTitle': 'Rainee Èõ®Èü≥„Éó„É¨„Ç§„É§„Éº - ÁÑ°Êñô„Ç™„É≥„É©„Ç§„É≥Èõ®Èü≥„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥',
    'seoTwitterDescription': 'Rainee„ÅØÁÑ°Êñô„ÅÆ„Ç™„É≥„É©„Ç§„É≥Èõ®Èü≥„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Å®„Éõ„ÉØ„Ç§„Éà„Éé„Ç§„Ç∫ÂÜçÁîü„ÇíÊèê‰æõ„Åó„Åæ„Åô„ÄÇÁù°Áú†„ÄÅ„É™„É©„ÇØ„Çº„Éº„Ç∑„Éß„É≥„ÄÅÁûëÊÉ≥„Å´ÂΩπÁ´ã„Å°„Åæ„Åô„ÄÇ'
  },
  'ko-KR': {
    'rain': 'ÎπÑ',
    'forest': 'Ïà≤',
    'ocean': 'Î∞îÎã§',
    'city': 'ÎèÑÏãú',
    'language': 'Ïñ∏Ïñ¥ Î≥ÄÍ≤Ω',
    'share': 'Ïù¥ ÌéòÏù¥ÏßÄ Í≥µÏú†',
    'donate': 'Ïª§Ìîº Ìïú Ïûî ÏÇ¨Ï£ºÍ∏∞',
    'copyLink': 'üîó ÎßÅÌÅ¨ Î≥µÏÇ¨',
    'favorite': '‚≠ê Ï¶êÍ≤®Ï∞æÍ∏∞',
    'mobileShare': 'üì± Í≥µÏú†',
    'paypal': 'üí≥ PayPal',
    'wechat': 'üí¨ WeChat',
    'alipay': 'üí∞ Alipay',
    'qrTitle': 'Ïä§Ï∫îÌïòÏó¨ Í≤∞Ï†ú',
    'qrTip': 'Ìï¥Îãπ Ïï±ÏúºÎ°ú QR ÏΩîÎìúÎ•º Ïä§Ï∫îÌïòÏó¨ Í≤∞Ï†úÎ•º ÏôÑÎ£åÌïòÏÑ∏Ïöî',
    'seoTitle': 'Rainee ÎπóÏÜåÎ¶¨ ÌîåÎ†àÏù¥Ïñ¥ - Î¨¥Î£å Ïò®ÎùºÏù∏ ÎπóÏÜåÎ¶¨ ÏãúÎÆ¨Î†àÏù¥ÏÖò | ÏàòÎ©¥ Ïù¥ÏôÑ Î™ÖÏÉÅ ÏßëÏ§ë',
    'seoDescription': 'RaineeÎäî Î¨¥Î£å Ïò®ÎùºÏù∏ ÎπóÏÜåÎ¶¨ ÏãúÎÆ¨Î†àÏù¥ÏÖòÍ≥º ÌôîÏù¥Ìä∏ ÎÖ∏Ïù¥Ï¶à Ïû¨ÏÉùÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§. ÏàòÎ©¥, Ïù¥ÏôÑ, Î™ÖÏÉÅ, ÏßëÏ§ëÎ†• Ìñ•ÏÉÅÏóê ÎèÑÏõÄÏùÑ Ï§çÎãàÎã§. Îã§Ïö¥Î°úÎìú Î∂àÌïÑÏöî, Ï¶âÏãú ÏÇ¨Ïö© Í∞ÄÎä•, Îã§Íµ≠Ïñ¥ ÏßÄÏõê.',
    'seoKeywords': 'ÎπóÏÜåÎ¶¨ ÏãúÎÆ¨Î†àÏù¥ÏÖò,ÌôîÏù¥Ìä∏ ÎÖ∏Ïù¥Ï¶à,ÏàòÎ©¥ Í∞úÏÑ†,Ïù¥ÏôÑ,Î™ÖÏÉÅ,ÏßëÏ§ëÎ†•,ÏûêÏó∞ ÏÜåÎ¶¨,Ïò®ÎùºÏù∏ Ïû¨ÏÉù,Î¨¥Î£å,ÎπóÏÜåÎ¶¨,ÌôîÏù¥Ìä∏ ÎÖ∏Ïù¥Ï¶à,ÏàòÎ©¥ ÏÜåÎ¶¨,ÏßëÏ§ë',
    'seoOgTitle': 'Rainee ÎπóÏÜåÎ¶¨ ÌîåÎ†àÏù¥Ïñ¥ - Î¨¥Î£å Ïò®ÎùºÏù∏ ÎπóÏÜåÎ¶¨ ÏãúÎÆ¨Î†àÏù¥ÏÖò',
    'seoOgDescription': 'RaineeÎäî Î¨¥Î£å Ïò®ÎùºÏù∏ ÎπóÏÜåÎ¶¨ ÏãúÎÆ¨Î†àÏù¥ÏÖòÍ≥º ÌôîÏù¥Ìä∏ ÎÖ∏Ïù¥Ï¶à Ïû¨ÏÉùÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§. ÏàòÎ©¥, Ïù¥ÏôÑ, Î™ÖÏÉÅ, ÏßëÏ§ëÎ†• Ìñ•ÏÉÅÏóê ÎèÑÏõÄÏùÑ Ï§çÎãàÎã§.',
    'seoTwitterTitle': 'Rainee ÎπóÏÜåÎ¶¨ ÌîåÎ†àÏù¥Ïñ¥ - Î¨¥Î£å Ïò®ÎùºÏù∏ ÎπóÏÜåÎ¶¨ ÏãúÎÆ¨Î†àÏù¥ÏÖò',
    'seoTwitterDescription': 'RaineeÎäî Î¨¥Î£å Ïò®ÎùºÏù∏ ÎπóÏÜåÎ¶¨ ÏãúÎÆ¨Î†àÏù¥ÏÖòÍ≥º ÌôîÏù¥Ìä∏ ÎÖ∏Ïù¥Ï¶à Ïû¨ÏÉùÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§. ÏàòÎ©¥, Ïù¥ÏôÑ, Î™ÖÏÉÅÏóê ÎèÑÏõÄÏùÑ Ï§çÎãàÎã§.'
  }
};

// Ëé∑ÂèñÁî®Êà∑ËØ≠Ë®ÄÂÅèÂ•Ω
function getUserLanguage() {
  const savedLang = localStorage.getItem('rainyMoodLang');
  if (savedLang) return savedLang;
  
  const browserLang = navigator.language || navigator.userLanguage;
  const supportedLangs = Object.keys(i18n);
  
  // ÂåπÈÖçÂÆåÊï¥ËØ≠Ë®Ä‰ª£Á†Å
  if (supportedLangs.includes(browserLang)) {
    return browserLang;
  }
  
  // ÂåπÈÖçËØ≠Ë®ÄÂâçÁºÄ
  const langPrefix = browserLang.split('-')[0];
  const matchedLang = supportedLangs.find(lang => lang.startsWith(langPrefix));
  if (matchedLang) {
    return matchedLang;
  }
  
  return 'en-US'; // ÈªòËÆ§ËØ≠Ë®Ä
}

// ËÆæÁΩÆËØ≠Ë®Ä
function setLanguage(lang) {
  localStorage.setItem('rainyMoodLang', lang);
  updateUIText();
}

// Ëé∑ÂèñÁøªËØëÊñáÊú¨
function t(key, lang = null) {
  const targetLang = lang || getUserLanguage();
  return i18n[targetLang]?.[key] || i18n['en-US'][key] || key;
}

// Êõ¥Êñ∞UIÊñáÊú¨
function updateUIText() {
  // Êõ¥Êñ∞Â∑•ÂÖ∑ÊåâÈíÆtooltip
  const toolButtons = document.querySelectorAll('.utility-btn[data-i18n]');
  toolButtons.forEach(button => {
    const key = button.dataset.i18n;
    if (key) {
      button.setAttribute('data-tooltip', t(key));
    }
  });

  // Êõ¥Êñ∞ËèúÂçïÈ°π - Áõ¥Êé•ÊõøÊç¢ÂÆåÊï¥ÊñáÊú¨ÔºàÂåÖÂê´emojiÔºâ
  const menuOptions = document.querySelectorAll('.utility-option[data-i18n]');
  menuOptions.forEach(option => {
    const key = option.dataset.i18n;
    if (key) {
      option.innerHTML = t(key);
    }
  });

  // Êõ¥Êñ∞Êí≠ÊîæÂàóË°®È°πÁõÆ
  const playlistItems = document.querySelectorAll('.playlist-item');
  playlistItems.forEach(item => {
    const key = item.dataset.key;
    if (key) {
      const span = item.querySelector('span[data-i18n]');
      if (span) {
        span.textContent = t(key);
      }
    }
  });

  // Êõ¥Êñ∞‰∫åÁª¥Á†ÅÊ®°ÊÄÅÊ°ÜÊñáÊú¨
  const qrTitle = document.getElementById('qrTitle');
  if (qrTitle) {
    qrTitle.textContent = t('qrTitle');
  }

  const qrTip = document.querySelector('.qr-tip');
  if (qrTip) {
    qrTip.textContent = t('qrTip');
  }

  // Êõ¥Êñ∞SEO metaÊ†áÁ≠æ
  updateSEOMetaTags();
}

// Êõ¥Êñ∞SEO metaÊ†áÁ≠æ
function updateSEOMetaTags() {
  const currentLang = getUserLanguage();
  
  // Êõ¥Êñ∞title
  const seoTitle = t('seoTitle');
  if (seoTitle) {
    document.title = seoTitle;
  }

  // Êõ¥Êñ∞description
  const seoDescription = t('seoDescription');
  if (seoDescription) {
    const metaDescription = document.querySelector('meta[name="description"]');
    if (metaDescription) {
      metaDescription.setAttribute('content', seoDescription);
    }
  }

  // Êõ¥Êñ∞keywords
  const seoKeywords = t('seoKeywords');
  if (seoKeywords) {
    const metaKeywords = document.querySelector('meta[name="keywords"]');
    if (metaKeywords) {
      metaKeywords.setAttribute('content', seoKeywords);
    }
  }

  // Êõ¥Êñ∞Open GraphÊ†áÁ≠æ
  const seoOgTitle = t('seoOgTitle');
  const seoOgDescription = t('seoOgDescription');
  
  if (seoOgTitle) {
    const ogTitle = document.querySelector('meta[property="og:title"]');
    if (ogTitle) {
      ogTitle.setAttribute('content', seoOgTitle);
    }
  }
  
  if (seoOgDescription) {
    const ogDescription = document.querySelector('meta[property="og:description"]');
    if (ogDescription) {
      ogDescription.setAttribute('content', seoOgDescription);
    }
  }

  // Êõ¥Êñ∞Twitter CardÊ†áÁ≠æ
  const seoTwitterTitle = t('seoTwitterTitle');
  const seoTwitterDescription = t('seoTwitterDescription');
  
  if (seoTwitterTitle) {
    const twitterTitle = document.querySelector('meta[name="twitter:title"]');
    if (twitterTitle) {
      twitterTitle.setAttribute('content', seoTwitterTitle);
    }
  }
  
  if (seoTwitterDescription) {
    const twitterDescription = document.querySelector('meta[name="twitter:description"]');
    if (twitterDescription) {
      twitterDescription.setAttribute('content', seoTwitterDescription);
    }
  }

  // Êõ¥Êñ∞html langÂ±ûÊÄß
  document.documentElement.setAttribute('lang', currentLang);
}

// ÂàùÂßãÂåñi18n
function initI18n() {
  updateUIText();
  updateSEOMetaTags(); // Á°Æ‰øùÈ¶ñÊ¨°Âä†ËΩΩÊó∂‰πüÊõ¥Êñ∞SEOÊ†áÁ≠æ
  
  // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®ËØ≠Ë®ÄÊåâÈíÆ
  const existingLangBtn = document.getElementById('languageBtn');
  if (existingLangBtn) {
    // ‰ΩøÁî®Â∑≤Â≠òÂú®ÁöÑËØ≠Ë®ÄÊåâÈíÆ
    const langBtn = existingLangBtn;
    langBtn.setAttribute('data-i18n', 'language');
  } else {
    // ÂàõÂª∫ËØ≠Ë®ÄÊåâÈíÆÔºàÂÖºÂÆπÊóßÁâàÊú¨Ôºâ
    const container = document.querySelector('.container');
    let utilityBar = document.querySelector('.utility-bar');
    if (!utilityBar) {
      utilityBar = document.createElement('div');
      utilityBar.className = 'utility-bar';
      if (container) {
        container.appendChild(utilityBar);
      }
    }
    
    const langBtn = document.createElement('button');
    langBtn.className = 'utility-btn';
    langBtn.id = 'languageBtn';
    langBtn.setAttribute('data-i18n', 'language');
    langBtn.innerHTML = '<span class="utility-icon">üåê</span>';
    utilityBar.insertBefore(langBtn, utilityBar.firstChild);
  }
  
  // ÂàõÂª∫ËØ≠Ë®ÄÈÄâÊã©‰∏ãÊãâËèúÂçï
  const langDropdown = document.createElement('div');
  langDropdown.className = 'utility-dropdown';
  langDropdown.id = 'language-dropdown';
  langDropdown.innerHTML = `
    <button class="utility-option" data-lang="zh-CN">‰∏≠Êñá</button>
    <button class="utility-option" data-lang="en-US">English</button>
    <button class="utility-option" data-lang="ja-JP">Êó•Êú¨Ë™û</button>
    <button class="utility-option" data-lang="ko-KR">ÌïúÍµ≠Ïñ¥</button>
  `;
  
  // Ê∑ªÂä†‰∏ãÊãâËèúÂçïÂà∞ÂÆπÂô®
  const container = document.querySelector('.container');
  if (container) {
    container.appendChild(langDropdown);
  }
  
  // ËÆæÁΩÆËØ≠Ë®ÄÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
  const languageBtn = document.getElementById('languageBtn');
  if (languageBtn) {
    languageBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      const dropdown = document.getElementById('language-dropdown');
      dropdown.classList.toggle('show');
      
      // ÂÖ≥Èó≠ÂÖ∂‰ªñ‰∏ãÊãâËèúÂçï
      const otherDropdowns = document.querySelectorAll('.utility-dropdown:not(#language-dropdown)');
      otherDropdowns.forEach(d => d.classList.remove('show'));
    });
  }
  
  // ËÆæÁΩÆËØ≠Ë®ÄÈÄâÈ°πÁÇπÂáª‰∫ã‰ª∂
  const langOptions = document.querySelectorAll('#language-dropdown .utility-option');
  langOptions.forEach(option => {
    option.addEventListener('click', (e) => {
      const lang = e.target.dataset.lang;
      setLanguage(lang);
      document.getElementById('language-dropdown').classList.remove('show');
    });
  });
  
  // ÁÇπÂáªÂÖ∂‰ªñÂú∞ÊñπÂÖ≥Èó≠‰∏ãÊãâËèúÂçï
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.language-selector') && !e.target.closest('#language-dropdown')) {
      document.getElementById('language-dropdown').classList.remove('show');
    }
  });
}

// ÂØºÂá∫Âà∞ÂÖ®Â±Ä‰ΩúÁî®Âüü
window.i18n = {
  t,
  setLanguage,
  getUserLanguage,
  initI18n,
  updateUIText
};